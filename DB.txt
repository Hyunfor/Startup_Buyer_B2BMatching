# 상품
CREATE TABLE PRODUCT (
 	PNO NUMBER NOT NULL, 
	PNAME VARCHAR2(50) NOT NULL,
	CATEGORY VARCHAR2(50), 
	CONTENT VARCHAR2(1000) NOT NULL,
	REGDATE DATE DEFAULT SYSDATE,
    STARTUP_ID VARCHAR2(50),
	PRIMARY KEY (PNO)
 );
 
CREATE SEQUENCE SEQ_PRODUCT INCREMENT BY 1 START WITH 1; 
 
 select * from PRODUCT;
 
  select * from STARTUPID;

-- 테이블 삭제 
DROP TABLE PRODUCT;
 
DROP TABLE PRODUCT_IMG;

--시퀀스 삭제
drop sequence SEQ_PRODUCT;
-- 시퀀스 현재/ 다음값 조회
SELECT SEQ_PRODUCT.CURRVAL FROM DUAL;

SELECT SEQ_PRODUCT.NEXTVAL FROM DUAL;
 
 --페이징 테스트를 위해 데이터 INSERT
INSERT INTO PRODUCT( pno, pname, category, content, startup_Id, regdate)
SELECT SEQ_PRODUCT.nextval, pname, category, content, startup_Id, regdate FROM PRODUCT;
commit; 

--- 상품 이미지 테이블
CREATE TABLE PRODUCT_IMG(
 PIMAGE_NO NUMBER NOT NULL 
, IMG_NAME VARCHAR2(50) NOT NULL 
, PNO NUMBER NOT NULL 
, PRIMARY KEY (PIMAGE_NO) 
);

CREATE SEQUENCE SEQ_PRODUCT_IMG INCREMENT BY 1 START WITH 1;

select * from SEQ_PRODUCT_IMG;

-- 시퀀스 현재/ 다음값 조회
SELECT SEQ_PRODUCT_IMG.CURRVAL FROM DUAL;

SELECT SEQ_PRODUCT_IMG.NEXTVAL FROM DUAL;

--- PNO의 키를 레퍼런스로 PIMAGE_NO로 연결
ALTER TABLE PRODUCT_IMG 
ADD CONSTRAINTS PRODUCT_IMG_PNO FOREIGN KEY (PNO) 
REFERENCES PRODUCT(PNO);

select * from PRODUCT_IMG;

-- PRODUCT 데이터 추가
INSERT INTO PRODUCT (PNO, PNAME, CATEGORY, CONTENT, STARTUP_ID, REGDATE)
VALUES (SEQ_PRODUCT.NEXTVAL, '상품1', '카테고리1', '상품1 설명', '스타트업1', SYSDATE);

INSERT INTO PRODUCT (PNO, PNAME, CATEGORY, CONTENT, STARTUP_ID, REGDATE)
VALUES (SEQ_PRODUCT.NEXTVAL, '상품2', '카테고리2', '상품2 설명', '스타트업2', SYSDATE);
commit;

-- PRODUCT_IMG 데이터 추가
INSERT INTO PRODUCT_IMG (PIMAGE_NO, IMG_NAME, PNO)
VALUES (SEQ_PRODUCT_IMG.NEXTVAL, '이미지1.jpg', 1);

INSERT INTO PRODUCT_IMG (PIMAGE_NO, IMG_NAME, PNO)
VALUES (SEQ_PRODUCT_IMG.NEXTVAL, '이미지2.jpg', 1);

INSERT INTO PRODUCT_IMG (PIMAGE_NO, IMG_NAME, PNO)
VALUES (SEQ_PRODUCT_IMG.NEXTVAL, '이미지3.jpg', 2);

-- 스타트업 테이블
  CREATE TABLE START_UP
(
   STARTUPNAME          VARCHAR2(100) NOT NULL ,
   EMAIL                VARCHAR2(100) NOT NULL ,
   ESTABLISHED_YEAR     VARCHAR2(100) NOT NULL ,
   SIZES                 VARCHAR2(100) NOT NULL ,
   NO_OF_EMPLOYEES      VARCHAR2(100) NOT NULL ,
   CITY                 VARCHAR2(100) NOT NULL ,
   CATEGORYS             VARCHAR2(100) NOT NULL ,
   BUSINESS             VARCHAR2(100) NOT NULL ,
   ITEMS                VARCHAR2(100) NOT NULL ,
   REGDATE              DATE NOT NULL ,
   NAMES                 VARCHAR2(100) NOT NULL ,
   STARTUP_ID           VARCHAR2(100) NOT NULL 
);

select * from START_UP;

CREATE UNIQUE INDEX XPKSTART_UP ON START_UP (STARTUP_ID   ASC);

ALTER TABLE START_UP
   ADD CONSTRAINT  XPKSTART_UP PRIMARY KEY (STARTUP_ID);

ALTER TABLE START_UP MODIFY REGDATE VARCHAR2(5) NULL;  

-- 스타트업 시퀀스
 CREATE SEQUENCE SEQ_START_UP START WITH 1 INCREMENT BY 1;

drop sequence SEQ_START_UP;

ALTER TABLE PRODUCT
   ADD (CONSTRAINT R_51 FOREIGN KEY (STARTUP_ID) REFERENCES START_UP (STARTUP_ID));

commit;   

desc product;

--- 스타트업 유저 및 바이어 유저 테이블
CREATE TABLE STARTUP_USER (
 S_NAME VARCHAR2(50) NOT NULL, 
 S_ID VARCHAR2(50) NOT NULL, 
 S_PW VARCHAR2(50) NOT NULL, 
 NAME VARCHAR2(50) NOT NULL, 
 PRIMARY KEY (S_ID)
 );
 
-- 스타트업 시퀀스
 CREATE SEQUENCE SEQ_STARTUP_USER START WITH 1 INCREMENT BY 1;

drop sequence SEQ_STARTUP_USER;

drop sequence STARTUP_USER_SEQ;
 
 DROP TABLE STARTUP_USER;
 
  select * from STARTUP_USER;
  
INSERT INTO STARTUP_USER (S_NAME, S_ID, S_PW, NAME)
VALUES ('Unicorn', 'Unicorn', 'Unicorn', 'Unicorn');
commit;  
 
 CREATE TABLE BUYER_USER (
 B_NAME VARCHAR2(50) NOT NULL, 
 B_ID VARCHAR2(50) NOT NULL, 
 B_PW VARCHAR2(50) NOT NULL,
 NAME VARCHAR2(50) NOT NULL, 
 PRIMARY KEY (B_ID)
 );
 
-- 스타트업 시퀀스
 CREATE SEQUENCE BUYER_USER_SEQ START WITH 1 INCREMENT BY 1;

drop sequence BUYER_USER_SEQ;

drop sequence BUYER_USER_SEQ;
 
 select * from BUYER_USER;
 
INSERT INTO BUYER_USER (B_NAME, B_ID, B_PW, NAME)
VALUES ('OilTech', 'OilTech', 'OilTech', 'OilTech');
commit;
 
CREATE TABLE BUYER ( 
 BUYER_ID NUMBER NOT NULL,
 BUYER_NAME VARCHAR2(50) NOT NULL,
 EMAIL VARCHAR2(100) NOT NULL,
 COUNTRY VARCHAR2(50) NOT NULL,
 CATEGORY VARCHAR2(50) NOT NULL,
 BUSINESS VARCHAR2(50) NOT NULL,
 ITEMS VARCHAR2(50) NOT NULL,
 ORDER_AMOUNT VARCHAR2(50) NULL,
 REGDATE DATE DEFAULT SYSDATE,
 PRIMARY KEY (BUYER_ID)
 );
 
 CREATE SEQUENCE SEQ_BUYER START WITH 1 INCREMENT BY 1;
 
 drop sequence SEQ_BUYER;

drop sequence BUYER_SEQ;
 
 select * from COMMENTs;
 DROP TABLE COMMENTS;
 
 # 댓글
  CREATE TABLE COMMENTS
(
   COMMENTNO           NUMBER NOT NULL ,
   PNO                  NUMBER NOT NULL ,
   STARTUP_ID           VARCHAR2(100) NOT NULL ,
   BUYERID             VARCHAR2(100) NOT NULL ,
   COMMENTS              VARCHAR2(1000) NOT NULL ,
   REGDATE              DATE NOT NULL 
);

CREATE UNIQUE INDEX XPKCOMMENTS ON COMMENTS
(COMMENTNO   ASC);

ALTER TABLE COMMENTs
   ADD CONSTRAINT  XPKCOMMENT PRIMARY KEY (COMMENTNO);

ALTER TABLE COMMENTS
   ADD (CONSTRAINT R_54 FOREIGN KEY (PNO) REFERENCES PRODUCT (PNO));
   
 CREATE SEQUENCE SEQ_COMMENTS START WITH 1 INCREMENT BY 1;
 
 drop sequence SEQ_COMMENTS;

-- 시퀀스 현재/ 다음값 조회
SELECT SEQ_COMMENTS.CURRVAL FROM DUAL;

SELECT SEQ_COMMENTS.NEXTVAL FROM DUAL;

SELECT * FROM USER_SEQUENCES;